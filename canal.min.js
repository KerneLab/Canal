(function(){function t(){this.downstream=null}function n(){this.index=void 0}function e(){this.sediment=void 0}function o(){}function r(){}function i(){this.branch=void 0}function u(){this.keyR=$,this.valR=_}function p(){}function c(t){function n(){}n.prototype=new i,n.prototype.that=function(){return t},n.prototype.accept=function(t){for(var n=this.branch,e=0;e<n.length;e++)if(!this.downstream.accept([t,n[e]]))return!1;return!0},this.newPond=function(){return new n}}function s(n){function e(){}e.prototype=new t,e.prototype.accept=function(t){return!n.apply(null,t)||this.downstream.accept(t)},this.newPond=function(){return new e}}function f(t){function n(){}n.prototype=new r,n.prototype.done=function(){if(null!=this.downstream){var n=this.settle(),e=[n],o={};for(var r in n)n.hasOwnProperty(r)&&(o[r]=null);for(var i=0;i<t.length;i++){n=t[i].groupBy().collectAsMap();for(var r in n)n.hasOwnProperty(r)&&(o[r]=null);e.push(n)}for(var u in o)if(o.hasOwnProperty(u)){for(var p=[],c=0;c<e.length;c++){var s=e[c][u];p.push(null!=s?s:[])}if(!this.downstream.accept([u,p]))break}this.downstream.done()}},this.newPond=function(){return new n}}function l(t){function n(){}t=null!=t?t:nt,n.prototype=new o,n.prototype.done=function(){if(null!=this.downstream){var n=this.settle();n.sort(t);for(var e=Y,o=null,r=0;r<n.length;r++)if(o=n[r],e===Y||0!==t(e,o)){if(!this.downstream.accept(o))break;e=o}this.downstream.done()}},this.newPond=function(){return new n}}function h(t){function e(){}e.prototype=new n,e.prototype.accept=function(n){return!t(n,this.index++)||this.downstream.accept(n)},this.newPond=function(){return new e}}function a(t){function e(){}e.prototype=new n,e.prototype.accept=function(n){var e=t(n,this.index++);if(e instanceof Array){for(var o=0;o<e.length;o++)if(!this.downstream.accept(e[o]))return!1;return!0}return this.downstream.accept(e)},this.newPond=function(){return new e}}function w(n){function e(){}e.prototype=new t,e.prototype.accept=function(t){return this.downstream.accept(et(t,n,[]))},this.newPond=function(){return new e}}function y(t,n,e,o,r){function i(){}n=null!=n?n:$,e=null!=e?e:$,o=null!=o?o:_,r=null!=r?r:_,i.prototype=new u,i.prototype.keyOf=function(t){return n(t)},i.prototype.valOf=function(t){return o(t)},i.prototype.that=function(){return t},i.prototype.base=function(t,n){var e={};for(var o in t)t.hasOwnProperty(o)&&(e[o]=null);for(var o in n)n.hasOwnProperty(o)&&(e[o]=null);return e},i.prototype.join=function(t,n,e,o){if(null!=e&&null!=o){for(r=0;r<e.length;r++)for(i=0;i<o.length;i++)if(!t.accept([n,[z.Some(e[r]),z.Some(o[i])]]))return!1}else if(null!=e){for(var r=0;r<e.length;r++)if(!t.accept([n,[z.Some(e[r]),z.None()]]))return!1}else if(null!=o)for(var i=0;i<o.length;i++)if(!t.accept([n,[z.None(),z.Some(o[i])]]))return!1;return!0},this.newPond=function(){var t=new i;return t.keyR=e,t.valR=r,t}}function d(t,n){function e(){}n=null!=n?n:nt,e.prototype=new i,e.prototype.that=function(){return t},e.prototype.accept=function(t){for(var e=this.branch,o=0;o<e.length;o++)if(0===n(t,e[o]))return this.downstream.accept(t);return!0},this.newPond=function(){return new e}}function v(t,n){function e(){}t=null!=t?t:$,n=null!=n?n:_,e.prototype=new r,e.prototype.keyOf=function(n){return t(n)},e.prototype.valOf=function(t){return n(t)},this.newPond=function(){return new e}}function m(t,n,e,o,r){function i(){}n=null!=n?n:$,e=null!=e?e:$,o=null!=o?o:_,r=null!=r?r:_,i.prototype=new u,i.prototype.keyOf=function(t){return n(t)},i.prototype.valOf=function(t){return o(t)},i.prototype.that=function(){return t},i.prototype.base=function(t,n){return t},i.prototype.join=function(t,n,e,o){if(null!=e&&null!=o)for(var r=0;r<e.length;r++)for(var i=0;i<o.length;i++)if(!t.accept([n,[e[r],o[i]]]))return!1;return!0},this.newPond=function(){var t=new i;return t.keyR=e,t.valR=r,t}}function g(t,n,e,o,r){function i(){}n=null!=n?n:$,e=null!=e?e:$,o=null!=o?o:_,r=null!=r?r:_,i.prototype=new u,i.prototype.keyOf=function(t){return n(t)},i.prototype.valOf=function(t){return o(t)},i.prototype.that=function(){return t},i.prototype.base=function(t,n){return t},i.prototype.join=function(t,n,e,o){if(null!=e)if(null!=o){for(i=0;i<e.length;i++)for(var r=0;r<o.length;r++)if(!t.accept([n,[e[i],z.Some(o[r])]]))return!1}else for(var i=0;i<e.length;i++)if(!t.accept([n,[e[i],z.None()]]))return!1;return!0},this.newPond=function(){var t=new i;return t.keyR=e,t.valR=r,t}}function P(t){function e(){}e.prototype=new n,e.prototype.accept=function(n){return this.downstream.accept(t(n,this.index++))},this.newPond=function(){return new e}}function b(n){function e(){}e.prototype=new t,e.prototype.accept=function(t){var e=t[1];return this.downstream.accept(n(e[0],e[1],t[0]))},this.newPond=function(){return new e}}function x(n,e,o){function r(){}e=null!=e?e:_,o=null!=o?o:$,r.prototype=new t,r.prototype.accept=function(t){var r=o(t);return this.downstream.accept([r,n(e(t),r)])},this.newPond=function(){return new r}}function k(t){function e(){}e.prototype=new n,e.prototype.accept=function(n){return!!this.downstream.accept(n)&&(t(n,this.index++),!0)},this.newPond=function(){return new e}}function O(){function t(){}t.prototype=new o,t.prototype.done=function(){if(null!=this.downstream){for(var t=this.settle(),n=t.length-1;n>=0&&this.downstream.accept(t[n]);n--);this.downstream.done()}},this.newPond=function(){return new t}}function N(t,n,e,o,r){function i(){}n=null!=n?n:$,e=null!=e?e:$,o=null!=o?o:_,r=null!=r?r:_,i.prototype=new u,i.prototype.keyOf=function(t){return n(t)},i.prototype.valOf=function(t){return o(t)},i.prototype.that=function(){return t},i.prototype.base=function(t,n){return n},i.prototype.join=function(t,n,e,o){if(null!=o)if(null!=e){for(i=0;i<o.length;i++)for(var r=0;r<e.length;r++)if(!t.accept([n,[z.Some(e[r]),o[i]]]))return!1}else for(var i=0;i<o.length;i++)if(!t.accept([n,[z.None(),o[i]]]))return!1;return!0},this.newPond=function(){var t=new i;return t.keyR=e,t.valR=r,t}}function B(t){function e(){}e.prototype=new n,e.prototype.accept=function(n){return this.index>=t?this.downstream.accept(n):(this.index++,!0)},this.newPond=function(){return new e}}function S(t,n){function e(){}n=null==n||n,e.prototype=new o,e.prototype.done=function(e){if(null!=this.downstream){var o=this.settle();if(null!=t?o.sort(t):o.sort(),n)for(r=0;r<o.length&&this.downstream.accept(o[r]);r++);else for(var r=o.length-1;r>=0&&this.downstream.accept(o[r]);r--);this.downstream.done()}},this.newPond=function(){return new e}}function M(t,n){function e(){}n=null==n||n,e.prototype=new o,e.prototype.done=function(){if(null!=this.downstream){for(var e=ut(this.settle(),t,n),o=0;o<e.length&&this.downstream.accept(e[o]);o++);this.downstream.done()}},this.newPond=function(){return new e}}function R(t,n){function e(){}n=null!=n?n:nt,e.prototype=new i,e.prototype.that=function(){return t},e.prototype.accept=function(t){for(var e=!1,o=this.branch,r=0;r<o.length;r++)if(0===n(t,o[r])){e=!0;break}return!!e||this.downstream.accept(t)},this.newPond=function(){return new e}}function W(n){function e(){}e.prototype=new t,e.prototype.accept=function(t){return this.downstream.accept(t)},e.prototype.done=function(){null!=this.downstream&&(null!=n?n.converge(this.downstream):this.downstream.done())},this.newPond=function(){return new e}}function j(n){function e(){}e.prototype=new t,e.prototype.accept=function(t){return this.downstream.accept(n.apply(null,t))},this.newPond=function(){return new e}}function A(){}function V(){function t(){}t.prototype=new A,t.prototype.settling=function(){return[]},t.prototype.accept=function(t){return this.settle().push(t),!0},this.newPond=function(){return new t}}function E(t,n){function e(){}t=null!=t?t:$,n=null!=n?n:_,e.prototype=new A,e.prototype.settling=function(){return{}},e.prototype.accept=function(e){return this.settle()[t(e)]=n(e),!0},this.newPond=function(){return new e}}function J(t,n){function e(){}e.prototype=new A,e.prototype.settling=function(){return t},e.prototype.accept=function(t){var e=n(this.settle(),t);return void 0!==e&&this.settle(e),!0},this.newPond=function(){return new e}}function D(t){function e(){}e.prototype=new n,e.prototype.accept=function(n){return t(n,this.index++),!0},e.prototype.get=function(){},this.newPond=function(){return new e}}function K(t){function n(){}n.prototype=new A,n.prototype.settling=function(){return Y},n.prototype.accept=function(n){return this.settle()!==Y?this.settle(t(this.settle(),n)):this.settle(n),!0},n.prototype.get=function(){return this.settle()!==Y?z.Some(this.settle()):z.None()},this.newPond=function(){return new n}}function F(t){function n(){}n.prototype=new A,n.prototype.settling=function(){return[]},n.prototype.accept=function(n){return this.settle().length<t&&(this.settle().push(n),!0)},this.newPond=function(){return new n}}function z(){var t=this,n=null,e=null,o=null,r=function(n){for(var e=t;null!=e&&null!=e.operator();e=e.upstream()){var o=e.operator().newPond();o.downstream=n,n=o}return n},i=function(t,n){t.begin();for(var e=n.iterator();e.hasNext()&&t.accept(e.next()););e.close(),t.done()},u=function(){for(var n=t,e=t;null!=n&&null!=e.upstream()&&(n=n.upstream(),null!=(e=e.upstream().upstream()));)if(n==e)return!1;return!0};this.upstream=function(){return arguments.length>0?(n=arguments[0],t):n},this.operator=function(){return arguments.length>0?(e=arguments[0],t):e},this.add=function(n){if(null!=n)return(new z).operator(n).upstream(t).source(this.source());throw new Error("Intermediate Operator Should Not Be null.")},this.source=function(){return arguments.length>0?(o=arguments[0],t):o},this.converge=function(t,n){if(null!=t){if(null!=(n=null!=n?n:this.source())){if(u())return i(r(t),n),t;throw new Error("Loop Dependency Was Detected.")}throw new Error("Data Source Was Not Specified.")}throw new Error("Downstream Pond Was Not Specified.")},this.evaluate=function(t){if(null!=t)return this.converge(t.newPond(),arguments[1]).get();throw new Error("Terminate Operator Was Not Specified.")},this.cartesian=function(t){return this.add(new c(t))},this.distinct=function(){return this.add(new l(arguments[0]))},this.filter=function(t){return this.add(new h(t))},this.flatMap=function(t){return this.add(new a(t))},this.groupBy=function(){return this.add(new v(arguments[0],arguments[1]))},this.intersection=function(t){return this.distinct(arguments[1]).add(new d(t.distinct(arguments[1]),arguments[1]))},this.keyBy=function(t){return this.map(function(n,e){return[t(n,e),n]})},this.limit=function(t){return this.filter(function(n,e){return e<t})},this.map=function(t){return this.add(new P(t))},this.peek=function(t){return this.add(new k(t))},this.reverse=function(){return this.add(new O)},this.skip=function(t){return this.add(new B(t))},this.sortBy=function(){return this.sortWith(rt(arguments),!0)},this.sortWith=function(){return this.add(new S(arguments[0],arguments[1]))},this.stratifyBy=function(){return this.stratifyWith(rt(arguments),!0)},this.stratifyWith=function(){return this.add(new M(arguments[0],arguments[1]))},this.subtract=function(t){return this.add(new R(t.distinct(arguments[1]),arguments[1]))},this.toRows=function(){var t=null!=arguments[0]?arguments[0]:Z;return this.map(function(n){return[t(n)]})},this.union=function(t){return this.add(new W(t))},this.zip=function(t){return this.map(function(t,n){return[n,t]}).join(t.map(function(t,n){return[n,t]})).mapJoint(function(t,n){return[t,n]})},this.cogroup=function(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);return this.add(new f(t))},this.foldByKey=function(t,n){return this.groupBy(arguments[2],arguments[3]).mapValues(function(e,o){return z.of(e).fold(t(o),n)})},this.fullJoin=function(t){return this.add(new y(t,arguments[1],arguments[2],arguments[3],arguments[4]))},this.join=function(t){return this.add(new m(t,arguments[1],arguments[2],arguments[3],arguments[4]))},this.keys=function(){return this.map(null!=arguments[0]?arguments[0]:$)},this.leftJoin=function(t){return this.add(new g(t,arguments[1],arguments[2],arguments[3],arguments[4]))},this.mapJoint=function(t){return this.add(new b(t))},this.mapValues=function(t){return this.add(new x(t,arguments[1],arguments[2]))},this.reduceByKey=function(t){return this.groupBy(arguments[1],arguments[2]).mapValues(function(n,e){return z.of(n).reduce(t).get()})},this.rightJoin=function(t){return this.add(new N(t,arguments[1],arguments[2],arguments[3],arguments[4]))},this.values=function(){return this.map(null!=arguments[0]?arguments[0]:_)},this.choose=function(t){return this.add(new s(t))},this.flatten=function(){return this.add(new w(arguments[0]))},this.unpack=function(t){return this.add(new j(t))},this.window=function(){for(var t=this,n=0;n<arguments.length;n++){var e=arguments[n],o=e.merger,r=it(e.part),i=it(e.order),u=e.scope;t=pt(t,o,r,i,u)}return t},this.collect=function(){return this.evaluate(new V)},this.count=function(){return this.map(function(t){return 1}).fold(0,function(t,n){return t+n})},this.countByValue=function(){var t=arguments.length>0?arguments[0]:function(t){return t};return this.map(function(n){return[t(n),1]}).groupBy().mapValues(function(t){return z.of(t).fold(0,function(t,n){return t+n})}).collectAsMap()},this.fold=function(t,n){return this.evaluate(new J(t,n))},this.foreach=function(t){this.evaluate(new D(t))},this.head=function(){var t=this.take(1);return t.length>0?z.Some(t[0]):z.None()},this.reduce=function(t){return this.evaluate(new K(t))},this.take=function(t){return this.evaluate(new F(t))},this.collectAsMap=function(){return this.evaluate(new E(arguments[0],arguments[1]))},this.countByKey=function(){return this.mapValues(function(){return 1}).foldByKey(function(){return 0},function(t,n){return t+n},arguments[0]).collectAsMap()}}function C(){}function I(){}function L(t,n,e){function o(t,n,e){this.array=t,this.index=n,this.end=e}n=Math.max(null==n?0:n,0),e=Math.min(null==e?t.length:e,t.length),o.prototype=new C,o.prototype.close=function(){this.array=null,this.index=null,this.end=null},o.prototype.hasNext=function(){return this.index<this.end},o.prototype.next=function(){return this.array[this.index++]},this.iterator=function(){return new o(t,n,e)}}function T(t,n){function e(){this.index=0,this.value=void 0}e.prototype=new C,e.prototype.close=function(){n instanceof Function&&n(this.index-1),this.index=null,this.value=null},e.prototype.hasNext=function(){return this.value=t(this.index++),this.value!==Y},e.prototype.next=function(){return this.value},this.iterator=function(){return new e}}function q(){}function G(t){this.get=function(){return t},this.source(new L([t]))}function H(){this.source(new L(X))}function Q(){this.merger=null,this.part=null,this.order=null,this.scope=null}var U="object"==typeof global&&global||this,X=[],Y={},Z=function(t){return t},$=function(t){return t[0]},_=function(t){return t[1]},tt=function(t,n){return t<n?-1:t>n?1:0},nt=function(t,n){return t===n?0:tt(t,n)},et=function(t,n,e){null==e&&(e=[]);for(var o=null,r=0;r<t.length;r++)o=t[r],(n>0||null==n)&&o instanceof Array?et(o,null==n?null:n-1,e):e.push(o);return e},ot=function(t,n,e){for(var o=null,r=0;r<e.length;r++){var i=e[r];i instanceof Function?(t.push(i),null!=o&&n.push(o),o=!0):"boolean"==typeof i&&(o=i)}null!=o&&n.push(o)},rt=function(t){if(null!=t){var n=[],e=[];return ot(n,e,t),function(t,o){for(var r=0,i=0;i<n.length;i++){var u=n[i];if(0!=(r=tt(u(t),u(o)))){e[i]||(r*=-1);break}}return r}}return null},it=function(t){if(null!=t){var n=[],e=[];return ot(n,e,t),function(t,o){for(var r=0,i=0;i<n.length;i++){var u=n[i];if(0!=(r=tt(u.apply(null,t),u.apply(null,o)))){e[i]||(r*=-1);break}}return r}}return null},ut=function(t,n,e){if(null!=n){t.sort(n);var o=null,r=null,i=null,u=[];if(e)for(p=0;p<t.length;p++)r=t[p],null!=i&&0==n(o,r)||(i=[],u.push(i)),i.push(r),o=r;else for(var p=t.length-1;p>=0;p--)r=t[p],null!=i&&0==n(o,r)||(i=[],u.push(i)),i.push(r),o=r;return u}return[t]},pt=function(t,n,e,o,r){var i=null!=r,u=null,p=null;return i&&(u=r[0],p=r[1]),t.stratifyWith(e).flatMap(function(t){for(var e=z.of(t).stratifyWith(o).collect(),r=[],c=null,s=null,f=null,l=0;l<e.length;l++){c=e[l];for(h=0;h<c.length;h++)r.push(c[h]);if(!i){f=r.length,s=n(r,0,f,f-1);for(var h=0;h<c.length;h++)c[h].push(s)}}if(e=null,i){var a=null,w=null;f=r.length;for(var y=0;y<f;y++)a=Math.max(null==u?0:y-u,0),w=Math.min(null==p?f:y+p+1,f),r[y].push(n(r,a,w,y))}return r})};t.prototype.begin=function(){null!=this.downstream&&this.downstream.begin()},t.prototype.accept=function(t){},t.prototype.done=function(){null!=this.downstream&&this.downstream.done()},n.prototype=new t,n.prototype.begin=function(){void 0===this.index&&(this.index=0),null!=this.downstream&&this.downstream.begin()},e.prototype=new t,e.prototype.settling=null,e.prototype.begin=function(){void 0===this.settle()&&null!=this.settling&&this.settle(this.settling()),null!=this.downstream&&this.downstream.begin()},e.prototype.settle=function(){return arguments.length>0?(this.sediment=arguments[0],this):this.sediment},o.prototype=new e,o.prototype.settling=function(){return[]},o.prototype.accept=function(t){return this.settle().push(t),!0},r.prototype=new e,r.prototype.settling=function(){return{}},r.prototype.keyOf=$,r.prototype.valOf=_,r.prototype.accept=function(t){var n=this.keyOf(t),e=this.settle(),o=e[n];return null==o&&(o=[],e[n]=o),o.push(this.valOf(t)),!0},r.prototype.done=function(){if(null!=this.downstream){var t=this.settle();for(var n in t)if(t.hasOwnProperty(n)&&!this.downstream.accept([n,t[n]]))break;this.downstream.done()}},i.prototype=new t,i.prototype.that=function(){},i.prototype.begin=function(){void 0===this.branch&&(this.branch=this.that().collect()),null!=this.downstream&&this.downstream.begin()},u.prototype=new r,u.prototype.that=function(){},u.prototype.base=function(t,n){},u.prototype.join=function(t,n,e,o){return!1},u.prototype.done=function(){if(null!=this.downstream){var t=this.settle(),n=this.that().groupBy(this.keyR,this.valR).collectAsMap(),e=this.base(t,n),o=this.downstream;for(var r in e)if(e.hasOwnProperty(r)&&!this.join(o,r,t[r],n[r]))break;o.done()}},p.prototype.newPond=function(){return new t},c.prototype=new p,s.prototype=new p,f.prototype=new p,l.prototype=new p,h.prototype=new p,a.prototype=new p,w.prototype=new p,y.prototype=new p,d.prototype=new p,v.prototype=new p,m.prototype=new p,g.prototype=new p,P.prototype=new p,b.prototype=new p,x.prototype=new p,k.prototype=new p,O.prototype=new p,N.prototype=new p,B.prototype=new p,S.prototype=new p,M.prototype=new p,R.prototype=new p,W.prototype=new p,j.prototype=new p,A.prototype=new e,A.prototype.get=function(){return this.settle()},V.prototype=new p,E.prototype=new p,J.prototype=new p,D.prototype=new p,K.prototype=new p,F.prototype=new p,z.eod=function(){return Y},z.mapOfPairs=function(t){for(var n={},e=0;e<t.length;e++){var o=t[e];n[o[0]]=o[1]}return n},z.pairsOfMap=function(t){var n=[];for(var e in t)t.hasOwnProperty(e)&&n.push([e,t[e]]);return n},C.prototype.close=function(){},C.prototype.hasNext=function(){},C.prototype.next=function(){},I.prototype.iterator=function(){},L.prototype=new I,T.prototype=new I,z.of=function(t){return t instanceof Array?(new z).source(new L(t,arguments[1],arguments[2])):t instanceof Function?(new z).source(new T(t,arguments[1])):z.of(z.pairsOfMap(t))},q.prototype=new z,q.prototype.get=function(){},q.prototype.or=function(t){},q.prototype.orNull=function(){},q.prototype.given=function(){},G.prototype=new q,G.prototype.or=function(t){return this.get()},G.prototype.orNull=function(){return this.get()},G.prototype.given=function(){return!0},H.prototype=new q,H.prototype.or=function(t){return t},H.prototype.orNull=function(){return null},H.prototype.given=function(){return!1},z.Some=function(t){return new G(t)},z.None=function(){return new H},Q.prototype.merge=function(){return arguments.length>0?(this.merger=arguments[0],this):this.merger},Q.prototype.partBy=function(){return arguments.length>0?(this.part=arguments,this):this.part},Q.prototype.orderBy=function(){return arguments.length>0?(this.order=arguments,this):this.order},Q.prototype.between=function(t,n){return arguments.length>0?(this.scope=[t,n],this):this.scope},z.item=function(t){return(new Q).merge(t)},"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports?module.exports=z:exports=z:U.Canal=z}).call(this);