/*! canal.js v1.0.0 2016-10-20 */

(function(){function a(){this.downstream=null}function b(){this.index=void 0}function c(){this.sediment=void 0}function d(){}function e(){}function f(){this.branch=void 0}function g(){this.keyR=V,this.valR=W}function h(){}function i(a){function b(){}b.prototype=new f,b.prototype.that=function(){return a},b.prototype.accept=function(a){var b=this.branch;for(var c in b)if(!this.downstream.accept([a,b[c]]))return!1;return!0},this.newPond=function(){return new b}}function j(a){function b(){}b.prototype=new e,b.prototype.done=function(){if(null!=this.downstream){var b=this.settle(),c=[b],d={};for(var e in b)d[e]=null;for(var f in a){b=a[f].groupBy().collectAsMap();for(e in b)d[e]=null;c.push(b)}for(var g in d){var h=[];for(var i in c){var j=c[i][g];h.push(null!=j?j:[])}if(!this.downstream.accept([g,h]))break}this.downstream.done()}},this.newPond=function(){return new b}}function m(a){function b(){}a=null!=a?a:X,b.prototype=new d,b.prototype.accept=function(b){var c=!1,d=this.settle();for(var e in d)if(a(b,d[e])){c=!0;break}return c||d.push(b),!0},b.prototype.done=function(){if(null!=this.downstream){var a=this.settle();for(var b in a)if(!this.downstream.accept(a[b]))break;this.downstream.done()}},this.newPond=function(){return new b}}function n(a){function c(){}c.prototype=new b,c.prototype.accept=function(b){return!a(b,this.index++)||this.downstream.accept(b)},this.newPond=function(){return new c}}function o(a){function c(){}c.prototype=new b,c.prototype.accept=function(b){var c=a(b,this.index++);if(c instanceof Array){for(var d in c)if(!this.downstream.accept(c[d]))return!1;return!0}return this.downstream.accept(c)},this.newPond=function(){return new c}}function p(a){function c(){}c.prototype=new b,c.prototype.accept=function(b){return a(b,this.index++),this.downstream.accept(b)},this.newPond=function(){return new c}}function q(a,b,c,d,e){function f(){}b=null!=b?b:V,c=null!=c?c:V,d=null!=d?d:W,e=null!=e?e:W,f.prototype=new g,f.prototype.keyOf=function(a){return b(a)},f.prototype.valOf=function(a){return d(a)},f.prototype.that=function(){return a},f.prototype.base=function(a,b){var c={};for(var d in a)c[d]=null;for(var d in b)c[d]=null;return c},f.prototype.join=function(a,b,c,d){if(null!=c&&null!=d){for(l in c)for(r in d)if(!a.accept([b,[K.Some(c[l]),K.Some(d[r])]]))return!1}else if(null!=c){for(l in c)if(!a.accept([b,[K.Some(c[l]),K.None]]))return!1}else if(null!=d)for(r in d)if(!a.accept([b,[K.None,K.Some(d[r])]]))return!1;return!0},this.newPond=function(){var a=new f;return a.keyR=c,a.valR=e,a}}function s(a,b){function c(){}b=null!=b?b:X,c.prototype=new f,c.prototype.that=function(){return a},c.prototype.accept=function(a){var c=this.branch;for(var d in c)if(b(a,c[d]))return this.downstream.accept(a);return!0},this.newPond=function(){return new c}}function t(a,b){function c(){}a=null!=a?a:V,b=null!=b?b:W,c.prototype=new e,c.prototype.keyOf=function(b){return a(b)},c.prototype.valOf=function(a){return b(a)},this.newPond=function(){return new c}}function u(a,b,c,d,e){function f(){}b=null!=b?b:V,c=null!=c?c:V,d=null!=d?d:W,e=null!=e?e:W,f.prototype=new g,f.prototype.keyOf=function(a){return b(a)},f.prototype.valOf=function(a){return d(a)},f.prototype.that=function(){return a},f.prototype.base=function(a,b){return a},f.prototype.join=function(a,b,c,d){if(null!=c&&null!=d)for(l in c)for(r in d)if(!a.accept([b,[c[l],d[r]]]))return!1;return!0},this.newPond=function(){var a=new f;return a.keyR=c,a.valR=e,a}}function v(a,b,c,d,e){function f(){}b=null!=b?b:V,c=null!=c?c:V,d=null!=d?d:W,e=null!=e?e:W,f.prototype=new g,f.prototype.keyOf=function(a){return b(a)},f.prototype.valOf=function(a){return d(a)},f.prototype.that=function(){return a},f.prototype.base=function(a,b){return a},f.prototype.join=function(a,b,c,d){if(null!=c)if(null!=d){for(l in c)for(r in d)if(!a.accept([b,[c[l],K.Some(d[r])]]))return!1}else for(l in c)if(!a.accept([b,[c[l],K.None]]))return!1;return!0},this.newPond=function(){var a=new f;return a.keyR=c,a.valR=e,a}}function w(a){function c(){}c.prototype=new b,c.prototype.accept=function(b){return this.downstream.accept(a(b,this.index++))},this.newPond=function(){return new c}}function x(b){function c(){}c.prototype=new a,c.prototype.accept=function(a){var c=a[1];return this.downstream.accept(b(c[0],c[1],a[0]))},this.newPond=function(){return new c}}function y(b,c,d){function e(){}c=null!=c?c:V,d=null!=d?d:W,e.prototype=new a,e.prototype.accept=function(a){var e=c(a);return this.downstream.accept([e,b(d(a),e)])},this.newPond=function(){return new e}}function z(){function a(){}a.prototype=new d,a.prototype.done=function(){if(null!=this.downstream){var a=this.settle();a.reverse();for(var b in a)if(!this.downstream.accept(a[b]))break;this.downstream.done()}},this.newPond=function(){return new a}}function A(a,b,c,d,e){function f(){}b=null!=b?b:V,c=null!=c?c:V,d=null!=d?d:W,e=null!=e?e:W,f.prototype=new g,f.prototype.keyOf=function(a){return b(a)},f.prototype.valOf=function(a){return d(a)},f.prototype.that=function(){return a},f.prototype.base=function(a,b){return b},f.prototype.join=function(a,b,c,d){if(null!=d)if(null!=c){for(r in d)for(l in c)if(!a.accept([b,[K.Some(c[l]),d[r]]]))return!1}else for(r in d)if(!a.accept([b,[K.None,d[r]]]))return!1;return!0},this.newPond=function(){var a=new f;return a.keyR=c,a.valR=e,a}}function B(a){function c(){}c.prototype=new b,c.prototype.accept=function(b){return this.index>=a?this.downstream.accept(b):(this.index++,!0)},this.newPond=function(){return new c}}function C(a,b){function c(){}b=null==b||b;var e=a;null==a||b||(e=function(b,c){return a(c,b)}),c.prototype=new d,c.prototype.done=function(a){if(null!=this.downstream){var c=this.settle();null!=e?c.sort(e):(c.sort(),b||c.reverse());for(var d in c)if(!this.downstream.accept(c[d]))break;this.downstream.done()}},this.newPond=function(){return new c}}function D(a,b){function c(){}b=null!=b?b:X,c.prototype=new f,c.prototype.that=function(){return a},c.prototype.accept=function(a){var c=!1,d=this.branch;for(var e in d)if(b(a,d[e])){c=!0;break}return!!c||this.downstream.accept(a)},this.newPond=function(){return new c}}function E(){}function F(){function a(){}a.prototype=new E,a.prototype.settling=function(){return[]},a.prototype.accept=function(a){return this.settle().push(a),!0},this.newPond=function(){return new a}}function G(a,b){function c(){}a=null!=a?a:V,b=null!=b?b:W,c.prototype=new E,c.prototype.settling=function(){return{}},c.prototype.accept=function(c){return this.settle()[a(c)]=b(c),!0},this.newPond=function(){return new c}}function H(a,b){function c(){}c.prototype=new E,c.prototype.settling=function(){return a},c.prototype.accept=function(a){var c=b(this.settle(),a);return void 0!==c&&this.settle(c),!0},this.newPond=function(){return new c}}function I(a){function b(){}b.prototype=new E,b.prototype.settling=function(){return[]},b.prototype.accept=function(b){return this.settle().length<a&&(this.settle().push(b),!0)},this.newPond=function(){return new b}}function J(b){function c(){}c.prototype=new a,c.prototype.accept=function(a){return this.downstream.accept(a)},c.prototype.done=function(){null!=this.downstream&&(null!=b?b.converge(this.downstream):this.downstream.done())},this.newPond=function(){return new c}}function K(){}function L(a){this.val=a}function M(){}function N(){}function O(){}function P(a){function b(){this.index=0}var c=a.length;b.prototype=new N,b.prototype.hasNext=function(){return this.index<c},b.prototype.next=function(){return a[this.index++]},this.iterator=function(){return new b}}function Q(a){function b(){this.index=0,this.value=void 0}b.prototype=new N,b.prototype.hasNext=function(){return this.value=a(this.index++),this.value!==U},b.prototype.next=function(){return this.value},this.iterator=function(){return new b}}function R(){var a=this,b=null,c=null,d=null,e=function(b){for(var c=a;null!=c&&null!=c.operator();c=c.upstream()){var d=c.operator().newPond();d.downstream=b,b=d}return b},f=function(a,b){a.begin();for(var c=b.iterator();c.hasNext()&&a.accept(c.next()););a.done()},g=function(){for(var b=a,c=a;null!=b&&null!=c.upstream()&&(b=b.upstream(),c=c.upstream().upstream(),null!=c);)if(b==c)return!1;return!0};this.upstream=function(){return arguments.length>0?(b=arguments[0],a):b},this.operator=function(){return arguments.length>0?(c=arguments[0],a):c},this.add=function(b){if(null!=b)return(new R).operator(b).upstream(a).source(this.source());throw new Error("Intermediate Operator Should Not Be null.")},this.source=function(){return arguments.length>0?(d=arguments[0],a):d},this.converge=function(a,b){if(null!=a){if(b=null!=b?b:this.source(),null!=b){if(g())return f(e(a),b),a;throw new Error("Loop Dependency Was Detected.")}throw new Error("Data Source Was Not Specified.")}throw new Error("Downstream Pond Was Not Specified.")},this.evaluate=function(a){if(null!=a)return this.converge(a.newPond(),arguments[1]).get();throw new Error("Terminate Operator Was Not Specified.")},this.cartesian=function(a){return this.add(new i(a))},this.distinct=function(){return this.add(new m(arguments[0]))},this.filter=function(a){return this.add(new n(a))},this.first=function(){var a=arguments.length>0?arguments[0]:1;return this.filter(function(b,c){return c<a})},this.flatMap=function(a){return this.add(new o(a))},this.foreach=function(a){return this.add(new p(a))},this.groupBy=function(){return this.add(new t(arguments[0],arguments[1]))},this.intersection=function(a){return this.distinct(arguments[1]).add(new s(a.distinct(arguments[1]),arguments[1]))},this.keyBy=function(a){return this.map(function(b,c){return[a(b,c),b]})},this.map=function(a){return this.add(new w(a))},this.reverse=function(){return this.add(new z)},this.skip=function(a){return this.add(new B(a))},this.sortWith=function(){return this.add(new C(arguments[0],arguments[1]))},this.subtract=function(a){return this.add(new D(a.distinct(arguments[1]),arguments[1]))},this.union=function(a){return this.add(new J(a))},this.zip=function(a){return this.map(function(a,b){return[b,a]}).join(a.map(function(a,b){return[b,a]})).mapJoint(function(a,b){return[a,b]})},this.cogroup=function(){return this.add(new j(arguments))},this.fullJoin=function(a){return this.add(new q(a,arguments[1],arguments[2],arguments[3],arguments[4]))},this.join=function(a){return this.add(new u(a,arguments[1],arguments[2],arguments[3],arguments[4]))},this.leftJoin=function(a){return this.add(new v(a,arguments[1],arguments[2],arguments[3],arguments[4]))},this.mapJoint=function(a){return this.add(new x(a))},this.mapValues=function(a){return this.add(new y(a,arguments[1],arguments[2]))},this.reduceByKey=function(a,b){return this.groupBy(arguments[2],arguments[3]).mapValues(function(c,d){return R.of(c).reduce(a(d),b)})},this.rightJoin=function(a){return this.add(new A(a,arguments[1],arguments[2],arguments[3],arguments[4]))},this.collect=function(){return this.evaluate(new F)},this.count=function(){return this.map(function(a){return 1}).evaluate(new H(0,function(a,b){return a+b}))},this.countByValue=function(){var a=arguments.length>0?arguments[0]:function(a){return a};return this.map(function(b){return[a(b),1]}).groupBy().mapValues(function(a){return R.of(a).reduce(0,function(a,b){return a+b})}).collectAsMap()},this.head=function(){var a=this.take(1);return a.length>0?K.Some(a[0]):K.None},this.reduce=function(a,b){return this.evaluate(new H(a,b))},this.take=function(a){return this.evaluate(new I(a))},this.collectAsMap=function(){return this.evaluate(new G(arguments[0],arguments[1]))},this.countByKey=function(){return this.mapValues(function(){return 1}).reduceByKey(function(){return 0},function(a,b){return a+b},arguments[0]).collectAsMap()}}var S="object"==typeof global&&global||this,T=[],U={},V=function(a){return a[0]},W=function(a){return a[1]},X=function(a,b){return a===b};a.prototype.begin=function(){null!=this.downstream&&this.downstream.begin()},a.prototype.accept=function(a){},a.prototype.done=function(){null!=this.downstream&&this.downstream.done()},b.prototype=new a,b.prototype.begin=function(){void 0===this.index&&(this.index=0),null!=this.downstream&&this.downstream.begin()},c.prototype=new a,c.prototype.settling=null,c.prototype.begin=function(){void 0===this.settle()&&null!=this.settling&&this.settle(this.settling()),null!=this.downstream&&this.downstream.begin()},c.prototype.settle=function(){return arguments.length>0?(this.sediment=arguments[0],this):this.sediment},d.prototype=new c,d.prototype.settling=function(){return[]},d.prototype.accept=function(a){return this.settle().push(a),!0},e.prototype=new c,e.prototype.settling=function(){return{}},e.prototype.keyOf=V,e.prototype.valOf=W,e.prototype.accept=function(a){var b=this.keyOf(a),c=this.settle(),d=c[b];return null==d&&(d=[],c[b]=d),d.push(this.valOf(a)),!0},e.prototype.done=function(){if(null!=this.downstream){var a=this.settle();for(var b in a)if(!this.downstream.accept([b,a[b]]))break;this.downstream.done()}},f.prototype=new a,f.prototype.that=function(){},f.prototype.begin=function(){void 0===this.branch&&(this.branch=this.that().collect()),null!=this.downstream&&this.downstream.begin()},g.prototype=new e,g.prototype.that=function(){},g.prototype.base=function(a,b){},g.prototype.join=function(a,b,c,d){return!1},g.prototype.done=function(){if(null!=this.downstream){var a=this.settle(),b=this.that().groupBy(this.keyR,this.valR).collectAsMap(),c=this.base(a,b),d=this.downstream;for(k in c)if(!this.join(d,k,a[k],b[k]))break;d.done()}},h.prototype.newPond=function(){return new a},i.prototype=new h,j.prototype=new h,m.prototype=new h,n.prototype=new h,o.prototype=new h,p.prototype=new h,q.prototype=new h,s.prototype=new h,t.prototype=new h,u.prototype=new h,v.prototype=new h,w.prototype=new h,x.prototype=new h,y.prototype=new h,z.prototype=new h,A.prototype=new h,B.prototype=new h,C.prototype=new h,D.prototype=new h,E.prototype=new c,E.prototype.get=function(){return this.settle()},F.prototype=new h,G.prototype=new h,H.prototype=new h,I.prototype=new h,J.prototype=new h,K.prototype.get=function(){},K.prototype.or=function(a){},K.prototype.orNull=function(){},K.prototype.given=function(){},K.prototype.canal=function(){},L.prototype=new K,L.prototype.get=function(){return this.val},L.prototype.or=function(a){return this.get()},L.prototype.orNull=function(){return this.get()},L.prototype.given=function(){return!0},L.prototype.canal=function(){return(new R).source([this.get()])},K.Some=function(a){return new L(a)},M.prototype=new K,M.prototype.or=function(a){return a},M.prototype.orNull=function(){return null},M.prototype.given=function(){return!1},M.prototype.canal=function(){return(new R).source(T)},K.None=new M,N.prototype.hasNext=function(){},N.prototype.next=function(){},O.prototype.iterator=function(){},P.prototype=new O,Q.prototype=new O,R.eod=function(){return U},R.of=function(a){return a instanceof Array?(new R).source(new P(a)):a instanceof Function?(new R).source(new Q(a)):R.of(R.pairsOfMap(a))},R.mapOfPairs=function(a){var b={};for(var c in a){var d=a[c];b[d[0]]=d[1]}return b},R.pairsOfMap=function(a){var b=[];for(var c in a)b.push([c,a[c]]);return b},S.Canal=R}).call(this);
//# sourceMappingURL=canal.min.map