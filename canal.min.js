/*! canal.js v1.0.61 2025-03-18 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.Canal=n()}(this,function(){"use strict";var t=[],n={},e=function(t){return t},r=function(t){return t[0]},o=function(t){return t[1]},u=function(){},i=function(t,n){return null==t?n:t},l=function(t){return i(t,0)},f=function(){},c=function(t){var n=function(){return t};return n.all=!0,n},s=function(){for(var t,n,e=0;e<arguments.length-1;e+=2){if((t=arguments[e])<(n=arguments[e+1]))return-1;if(t>n)return 1}return 0},p=function(t,n,e,r){return t==n?0:null==t||null==n?!0===r?null==t?-1:1:null==t?1:-1:t<n?-1*e:1*e},a=function(t,n){return t===n?0:s(t,n)},h=function(t){return null!=t&&t.constructor==Object},d=function(t){return null!=t&&t.constructor==Array},y=function(t,n,e){null==e&&(e=[]);for(var r=null,o=0;o<t.length;o++)r=t[o],(n>0||null==n)&&r instanceof Array?y(r,null==n?null:n-1,e):e.push(r);return e},w=function(t,n,e){for(var r=null,o=0;o<e.length;o++){var u=e[o];"boolean"==typeof u?r=!1===u?-1:1:"function"==typeof u&&(t.push(u),null!=r&&n.push(r),r=!1===u.order?-1:1)}null!=r&&n.push(r)},v=function(t){var n=[],e=[];return w(n,e,t),function(t,r){for(var o=0,u=0;u<n.length;u++){var i=n[u];if(0!=(o=p(i(t),i(r),e[u],"first"==i.nulls)))break}return o}},g=function(t,n,e){if(null!=n){t.sort(n);var r=null,o=null,u=null,i=[];if(e)for(var l=0;l<t.length;l++)o=t[l],null!=u&&0==n(r,o)||(u=[],i.push(u)),u.push(o),r=o;else for(l=t.length-1;l>=0;l--)o=t[l],null!=u&&0==n(r,o)||(u=[],i.push(u)),u.push(o),r=o;return i}return[t]},m=function(t,n,e,r,o,u,i){for(var l=r>0,f=t.length,c=null,s=null,p=e;l&&p<f||!l&&p>=0;p+=r)if(s=n(t[p]),o){if(!u(s,i))break;c=p}else if(u(s,i)){c=p;break}return c},x=function(t,n,e,r,o,i,l,f,c){n=null!=n?n:u,e=null!=e?e:function(t){return t},r=null!=r?r:function(t,n){return n};var s=null,p=null;null!=f?(s=f[0],p=f[1],c=null==c||c):c=null;var a=function(t,n){return t<=n&&null!=t&&null!=n||null==t&&null==n},h=function(t,n){return t>=n&&null!=t&&null!=n||null==t&&null==n},d=[],y=[],v=null,g=null;null!=l&&l.length>0&&(w(d,y,l),v=d[0],g=y[0]);var x=null;return null!=f&&(x=c?[function(t,n,e,r,o){return Math.max(null==e?0:n+e,0)},function(t,n,e,r,o){return Math.min(null==e?t.length:n+e+1,t.length)}]:[function(t,n,e){var r=t<0?-1:1,o=t<0,u=e>0?h:a;return function(t,i,l,f,c){return null==l?0:0==l?f:m(t,n,l<0?f:c-1,r,o,u,null!=i?i+e*l:null)}}(s,v,g),function(t,n,e){var r=t>0?1:-1,o=t>0,u=e>0?a:h;return function(t,i,l,f,c){var s=null;return null!=(s=null==l?t.length-1:0==l?c-1:m(t,n,l>0?c-1:f,r,o,u,null!=i?i+e*l:null))&&s++,s}}(p,v,g)]),t.stratifyBy.apply(t,i).flatMap(function(t){for(var u=ht.of(t),i=u.stratifyBy.apply(u,l).collect(),a=n(i),h=[],d=[],y=null,w=void 0,g=null,m=null,P=0;P<i.length;P++)if(y=i[P],d.push(y.length),m=h.length,h.push.apply(h,y),null==f){g=h.length,w=e(a,h,0,g,g-y.length,g);for(var b=0;b<y.length;b++)y[b][o]=r(m+b,w,h,0,g,g-y.length,g)}if(i=null,null!=f){var O=null,k=null;if(g=h.length,c)for(var M=0,B=0,N=0;N<d.length;N++){B+=d[N];for(var S=M;S<B;S++)O=x[0](h,S,s,M,B),k=x[1](h,S,p,M,B),w=e(a,h,O,k,M,B),h[S][o]=r(S,w,h,O,k,M,B);M=B}else{M=0,B=0;var R=void 0;for(N=0;N<d.length;N++){B+=d[N],R=v(h[M]),O=x[0](h,R,s,M,B),k=x[1](h,R,p,M,B),w=null!=O&&null!=k?e(a,h,O,k,M,B):void 0;for(S=M;S<B;S++)h[S][o]=r(S,w,h,O,k,M,B);M=B}}}return h})};function P(){this.downstream=null}function b(){this.index=void 0}function O(){this.sediment=void 0}function k(){}function M(){}function B(){this.branch=void 0}function N(){this.keyR=r,this.valR=o}function S(){}function R(t){function n(){}n.prototype=new B,n.prototype.that=function(){return t},n.prototype.accept=function(t){for(var n=this.branch,e=0;e<n.length;e++)if(!this.downstream.accept([t,n[e]]))return!1;return!0},this.newPond=function(){return new n}}function j(t){function n(){}n.prototype=new P,n.prototype.accept=function(n){return!t.apply(null,n)||this.downstream.accept(n)},this.newPond=function(){return new n}}function K(t){function n(){}n.prototype=new M,n.prototype.done=function(){if(null!=this.downstream){var n=this.settle(),e=[n],r={};for(var o in n)n.hasOwnProperty(o)&&(r[o]=null);for(var u=0;u<t.length;u++){for(var o in n=t[u].groupByKey().collectAsMap())n.hasOwnProperty(o)&&(r[o]=null);e.push(n)}for(var i in r)if(r.hasOwnProperty(i)){for(var l=[],f=0;f<e.length;f++){var c=e[f][i];l.push(null!=c?c:[])}if(!this.downstream.accept([i,l]))break}this.downstream.done()}},this.newPond=function(){return new n}}function W(t){function e(){}t=null!=t?t:a,e.prototype=new k,e.prototype.done=function(){if(null!=this.downstream){for(var e=this.settle(),r=[],o=0;o<e.length;o++)r.push([o,e[o]]);r.sort(function(n,e){var r=t(n[1],e[1]);return 0!=r?r:n[0]-e[0]});var u={},i=n,l=null;for(o=0;o<r.length;o++)l=r[o][1],i!==n&&0===t(i,l)||(u[r[o][0]]=!0,i=l);for(o=0;o<e.length&&(!u[o]||this.downstream.accept(e[o]));o++);this.downstream.done()}},this.newPond=function(){return new e}}function A(t){function n(){}n.prototype=new b,n.prototype.accept=function(n){return!t(n,this.index++)||this.downstream.accept(n)},this.newPond=function(){return new n}}function E(t){function n(){}t=null!=t?t:function(t){return t},n.prototype=new b,n.prototype.accept=function(n){for(var e=t(n,this.index++),r=0;r<e.length;r++)if(!this.downstream.accept(e[r]))return!1;return!0},this.newPond=function(){return new n}}function J(t){function n(){}n.prototype=new P,n.prototype.accept=function(n){return this.downstream.accept(y(n,t))},this.newPond=function(){return new n}}function _(t,n,e,u,i){function l(){}n=null!=n?n:r,e=null!=e?e:r,u=null!=u?u:o,i=null!=i?i:o,l.prototype=new N,l.prototype.keyOf=function(t){return n(t)},l.prototype.valOf=function(t){return u(t)},l.prototype.that=function(){return t},l.prototype.base=function(t,n){var e={};for(var r in t)t.hasOwnProperty(r)&&(e[r]=null);for(var r in n)n.hasOwnProperty(r)&&(e[r]=null);return e},l.prototype.join=function(t,n,e,r){if(null!=e&&null!=r){for(var o=0;o<e.length;o++)for(var u=0;u<r.length;u++)if(!t.accept([n,[ht.Some(e[o]),ht.Some(r[u])]]))return!1}else if(null!=e){for(o=0;o<e.length;o++)if(!t.accept([n,[ht.Some(e[o]),ht.None()]]))return!1}else if(null!=r)for(u=0;u<r.length;u++)if(!t.accept([n,[ht.None(),ht.Some(r[u])]]))return!1;return!0},this.newPond=function(){var t=new l;return t.keyR=e,t.valR=i,t}}function V(t,n){function e(){}t=null!=t?t:r,n=null!=n?n:o,e.prototype=new M,e.prototype.keyOf=function(n){return t(n)},e.prototype.valOf=function(t){return n(t)},this.newPond=function(){return new e}}function z(t,n){function e(){}n=null!=n?n:a,e.prototype=new B,e.prototype.that=function(){return t},e.prototype.accept=function(t){for(var e=this.branch,r=0;r<e.length;r++)if(0===n(t,e[r]))return this.downstream.accept(t);return!0},this.newPond=function(){return new e}}function D(t,n,e,u,i){function l(){}n=null!=n?n:r,e=null!=e?e:r,u=null!=u?u:o,i=null!=i?i:o,l.prototype=new N,l.prototype.keyOf=function(t){return n(t)},l.prototype.valOf=function(t){return u(t)},l.prototype.that=function(){return t},l.prototype.base=function(t,n){return t},l.prototype.join=function(t,n,e,r){if(null!=e&&null!=r)for(var o=0;o<e.length;o++)for(var u=0;u<r.length;u++)if(!t.accept([n,[e[o],r[u]]]))return!1;return!0},this.newPond=function(){var t=new l;return t.keyR=e,t.valR=i,t}}function I(t,n,e,u,i){function l(){}n=null!=n?n:r,e=null!=e?e:r,u=null!=u?u:o,i=null!=i?i:o,l.prototype=new N,l.prototype.keyOf=function(t){return n(t)},l.prototype.valOf=function(t){return u(t)},l.prototype.that=function(){return t},l.prototype.base=function(t,n){return t},l.prototype.join=function(t,n,e,r){if(null!=e)if(null!=r){for(var o=0;o<e.length;o++)for(var u=0;u<r.length;u++)if(!t.accept([n,[e[o],ht.Some(r[u])]]))return!1}else for(o=0;o<e.length;o++)if(!t.accept([n,[e[o],ht.None()]]))return!1;return!0},this.newPond=function(){var t=new l;return t.keyR=e,t.valR=i,t}}function L(t){function n(){}n.prototype=new b,n.prototype.accept=function(n){return null==t||t<0||this.index++<t?this.downstream.accept(n):(null!=this.downstream&&this.downstream.done(),!1)},this.newPond=function(){return new n}}function C(t){function n(){}n.prototype=new b,n.prototype.accept=function(n){return this.downstream.accept(t(n,this.index++))},this.newPond=function(){return new n}}function F(t){function n(){}n.prototype=new P,n.prototype.accept=function(n){var e=n[1];return this.downstream.accept(t(e[0],e[1],n[0]))},this.newPond=function(){return new n}}function T(t,n,e){function u(){}n=null!=n?n:o,e=null!=e?e:r,u.prototype=new P,u.prototype.accept=function(r){var o=e(r);return this.downstream.accept([o,t(n(r),o)])},this.newPond=function(){return new u}}function $(t,n){function e(){}"function"==typeof t&&(t=t()),e.prototype=new b,e.prototype.accept=function(e){return this.downstream.accept(n(e,t,this.index++))},this.newPond=function(){return new e}}function q(t){function n(){}t=null==t?f:t,n.prototype=new b,n.prototype.accept=function(n){return!!this.downstream.accept(n)&&(t(n,this.index++),!0)},this.newPond=function(){return new n}}function G(){function t(){}t.prototype=new k,t.prototype.done=function(){if(null!=this.downstream){for(var t=this.settle(),n=t.length-1;n>=0&&this.downstream.accept(t[n]);n--);this.downstream.done()}},this.newPond=function(){return new t}}function H(t,n,e,u,i){function l(){}n=null!=n?n:r,e=null!=e?e:r,u=null!=u?u:o,i=null!=i?i:o,l.prototype=new N,l.prototype.keyOf=function(t){return n(t)},l.prototype.valOf=function(t){return u(t)},l.prototype.that=function(){return t},l.prototype.base=function(t,n){return n},l.prototype.join=function(t,n,e,r){if(null!=r)if(null!=e){for(var o=0;o<r.length;o++)for(var u=0;u<e.length;u++)if(!t.accept([n,[ht.Some(e[u]),r[o]]]))return!1}else for(o=0;o<r.length;o++)if(!t.accept([n,[ht.None(),r[o]]]))return!1;return!0},this.newPond=function(){var t=new l;return t.keyR=e,t.valR=i,t}}function Q(t){function n(){}n.prototype=new b,n.prototype.accept=function(n){return this.index>=t?this.downstream.accept(n):(this.index++,!0)},this.newPond=function(){return new n}}function U(t,n){function e(){this.gap=0,this.added=!1}e.prototype=new O,e.prototype.settling=function(){return null},e.prototype.accept=function(e){if(null==t||t<=0)return!1;if(this.gap>0)return this.gap--,!0;if(null==this.settle()&&this.settle([]),this.settle().length<t&&(this.settle().push(e),this.added=!0),this.settle().length==t){var r=this.downstream.accept(this.settle());return this.settle(n>=t?[]:this.settle().slice(n)),this.gap=n-t,this.added=!1,r}return!0},e.prototype.done=function(t){null!=this.settle()&&!0===this.added&&this.downstream.accept(this.settle()),this.downstream.done()},this.newPond=function(){return new e}}function X(t,n){function e(){}n=null==n||n,e.prototype=new k,e.prototype.done=function(e){if(null!=this.downstream){var r=this.settle();if(null!=t?r.sort(t):r.sort(),n)for(var o=0;o<r.length&&this.downstream.accept(r[o]);o++);else for(o=r.length-1;o>=0&&this.downstream.accept(r[o]);o--);this.downstream.done()}},this.newPond=function(){return new e}}function Y(t,n){function e(){}n=null==n||n,e.prototype=new k,e.prototype.done=function(){if(null!=this.downstream){for(var e=g(this.settle(),t,n),r=0;r<e.length&&this.downstream.accept(e[r]);r++);this.downstream.done()}},this.newPond=function(){return new e}}function Z(t,n){function e(){}n=null!=n?n:a,e.prototype=new B,e.prototype.that=function(){return t},e.prototype.accept=function(t){for(var e=!1,r=this.branch,o=0;o<r.length;o++)if(0===n(t,r[o])){e=!0;break}return!!e||this.downstream.accept(t)},this.newPond=function(){return new e}}function tt(t){function n(){}n.prototype=new P,n.prototype.accept=function(t){return this.downstream.accept(t)},n.prototype.done=function(){null!=this.downstream&&(null!=t?t.converge(this.downstream):this.downstream.done())},this.newPond=function(){return new n}}function nt(t){function n(){}n.prototype=new P,n.prototype.accept=function(n){return this.downstream.accept(t.apply(null,n))},this.newPond=function(){return new n}}function et(t,n){function e(){null!=n&&(n[0]=ht.None())}e.prototype=new b,e.prototype.accept=function(e){return t(e,this.index++)?(null!=n&&(n[0]=ht.Some(e)),null!=this.downstream&&this.downstream.done(),!1):this.downstream.accept(e)},this.newPond=function(){return new e}}function rt(){function t(){this.next=n,this.head=1}t.prototype=new P,t.prototype.accept=function(t){if(this.next==n)return this.next=t,!0;var e=this.next,r=this.head;return this.next=t,this.head=0,this.downstream.accept([e,0|r])},t.prototype.done=function(t){null!=this.downstream&&(this.next!=n&&this.downstream.accept([this.next,2|this.head]),this.downstream.done())},this.newPond=function(){return new t}}function ot(){}function ut(){function t(){}t.prototype=new ot,t.prototype.settling=function(){return[]},t.prototype.accept=function(t){return this.settle().push(t),!0},this.newPond=function(){return new t}}function it(t,n){function e(){}t=null!=t?t:r,n=null!=n?n:o,e.prototype=new ot,e.prototype.settling=function(){return{}},e.prototype.accept=function(e){return this.settle()[t(e)]=n(e),!0},this.newPond=function(){return new e}}function lt(t,e,r){function o(){this.empty=!0,this.meet=null==r}o.prototype=new ot,o.prototype.settling=function(){return"function"==typeof t?n:t},o.prototype.accept=function(n){this.empty&&(this.empty=!1,"function"==typeof t&&this.settle(t()));var o=e(this.settle(),n);return void 0!==o&&this.settle(o),null==r||!r(this.settle())||(this.meet=!0,!1)},o.prototype.get=function(){return"function"!=typeof t&&null==r?this.settle():this.meet&&!this.empty?ht.Some(this.settle()):ht.None()},this.newPond=function(){return new o}}function ft(t){function n(){this.meet=!0}n.prototype=new ot,n.prototype.settle=function(){return this.meet},n.prototype.accept=function(n){return!!t(n)||(this.meet=!1,!1)},this.newPond=function(){return new n}}function ct(t){function n(){}t=null==t?f:t,n.prototype=new b,n.prototype.accept=function(n){return t(n,this.index++),!0},n.prototype.get=u,this.newPond=function(){return new n}}function st(){function t(){}t.prototype=new ot,t.prototype.settling=function(){return n},t.prototype.accept=function(t){return this.settle(t),!0},t.prototype.get=function(){return this.settle()!==n?ht.Some(this.settle()):ht.None()},this.newPond=function(){return new t}}function pt(t,e){function r(){this.meet=null==e}r.prototype=new ot,r.prototype.settling=function(){return n},r.prototype.accept=function(r){return this.settle()!==n?this.settle(t(this.settle(),r)):this.settle(r),null==e||!e(this.settle())||(this.meet=!0,!1)},r.prototype.get=function(){return this.meet&&this.settle()!==n?ht.Some(this.settle()):ht.None()},this.newPond=function(){return new r}}function at(t){function n(){}n.prototype=new ot,n.prototype.settling=function(){return[]},n.prototype.accept=function(n){return this.settle().length<t&&(this.settle().push(n),!0)},this.newPond=function(){return new n}}function ht(){var t=this,n=null,e=null,u=null;this.upstream=function(){return arguments.length>0?(n=arguments[0],t):n},this.operator=function(){return arguments.length>0?(e=arguments[0],t):e},this.add=function(n){if(null!=n)return(new ht).operator(n).upstream(t).source(this.source());throw new Error("Intermediate Operator Should Not Be null.")},this.source=function(){return arguments.length>0?(u=arguments[0],t):u},this.converge=function(n,e){if(null!=n){if(null!=(e=null!=e?e:this.source())){if(function(){for(var n=t,e=t;null!=n&&null!=e.upstream()&&(n=n.upstream(),null!=(e=e.upstream().upstream()));)if(n==e)return!1;return!0}())return function(t,n){t.begin();for(var e=n.iterator();e.hasNext()&&t.accept(e.next()););e.close(),t.done()}(function(n){for(var e=t;null!=e&&null!=e.operator();e=e.upstream()){var r=e.operator().newPond();r.downstream=n,n=r}return n}(n),e),n;throw new Error("Loop Dependency Was Detected.")}throw new Error("Data Source Was Not Specified.")}throw new Error("Downstream Pond Was Not Specified.")},this.evaluate=function(t){if(null!=t)return this.converge(t.newPond(),arguments[1]).get();throw new Error("Terminate Operator Was Not Specified.")},this.cartesian=function(t){return this.add(new R(t))},this.distinct=function(){return this.add(new W(arguments[0]))},this.filter=function(t){return this.add(new A(t))},this.flatMap=function(t){return this.add(new E(t))},this.groupBy=function(t){var n=arguments.length>1?arguments[1]:function(t){return t};return this.add(new V(t,n))},this.intersection=function(t){return this.distinct(arguments[1]).add(new z(t.distinct(arguments[1]),arguments[1]))},this.keyBy=function(t){return this.map(function(n,e){return[t(n,e),n]})},this.limit=function(t){return this.add(new L(t))},this.map=function(t){return this.add(new C(t))},this.mapWithState=function(t,n){return this.add(new $(t,n))},this.peek=function(t){return this.add(new q(t))},this.reverse=function(){return this.add(new G)},this.skip=function(t){return this.add(new Q(t))},this.sliding=function(t,n){return(null==n||n<=0)&&(n=t),this.add(new U(t,n))},this.sortBy=function(){var t=arguments.length>0&&d(arguments[0])?arguments[0]:arguments;return this.sortWith(v(t),!0)},this.sortWith=function(){return this.add(new X(arguments[0],arguments[1]))},this.stratifyBy=function(){var t=arguments.length>0&&d(arguments[0])?arguments[0]:arguments;return this.stratifyWith(v(t),!0)},this.stratifyWith=function(){return this.add(new Y(arguments[0],arguments[1]))},this.subtract=function(t){return this.add(new Z(t.distinct(arguments[1]),arguments[1]))},this.union=function(t){return this.add(new tt(t))},this.until=function(t){return this.add(new et(t,arguments[1]))},this.zip=function(t){return this.map(function(t,n){return[n,t]}).join(t.map(function(t,n){return[n,t]})).mapJoint(function(t,n){return[t,n]})},this.zipOuter=function(t){return this.map(function(t,n){return[n,t]}).fullJoin(t.map(function(t,n){return[n,t]})).mapJoint(function(t,n){return[t,n]})},this.zipWithIndex=function(){return this.map(function(t,n){return[t,n]})},this.zipWithPhase=function(){return this.add(new rt)},this.cogroup=function(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);return this.add(new K(t))},this.foldByKey=function(t,n){return this.groupByKey(arguments[2],arguments[3]).mapValues(function(e,r){return ht.of(e).fold(t(r),n)})},this.fullJoin=function(t){return this.add(new _(t,arguments[1],arguments[2],arguments[3],arguments[4]))},this.groupByKey=function(){return this.add(new V(arguments[0],arguments[1]))},this.having=function(t){var n=null!=arguments[1]?arguments[1]:o,e=null!=arguments[2]?arguments[2]:r;return this.filter(function(r){return t(n(r),e(r))})},this.join=function(t){return this.add(new D(t,arguments[1],arguments[2],arguments[3],arguments[4]))},this.keys=function(){return this.map(null!=arguments[0]?arguments[0]:r)},this.leftJoin=function(t){return this.add(new I(t,arguments[1],arguments[2],arguments[3],arguments[4]))},this.mapJoint=function(t){return this.add(new F(t))},this.mapValues=function(t){return this.add(new T(t,arguments[1],arguments[2]))},this.reduceByKey=function(t){return this.groupByKey(arguments[1],arguments[2]).mapValues(function(n,e){return ht.of(n).reduce(t).get()})},this.rightJoin=function(t){return this.add(new H(t,arguments[1],arguments[2],arguments[3],arguments[4]))},this.values=function(){return this.map(null!=arguments[0]?arguments[0]:o)},this.choose=function(t){return this.add(new j(t))},this.flatten=function(){return this.add(new J(arguments[0]))},this.unpack=function(t){return this.add(new nt(t))},this.select=function(){if(arguments.length>0){var t={},n=arguments[0];if(h(n)){var e=null;for(var r in n)e=n[r],t[r]="function"==typeof e?e:ht.col(e)}else for(var o=d(n)?n:arguments,u=(e=null,0);u<o.length;u++)"function"==typeof(e=o[u])?t[e.alias]=e:t[e]=ht.col(e);var i=!1;for(var r in t)t.hasOwnProperty(r)&&t[r].all&&(i=!0,delete t[r]);return this.map(function(n){var e={};if(i)for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);for(var r in t)t.hasOwnProperty(r)&&(e[r]=null!=t[r]?t[r](n):null);return e})}return this.map(function(t){var n={};for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n})},this.window=function(){for(var t=this,n=0;n<arguments.length;n++){var e=arguments[n],r=e.aggr,o=e.updt,u=e.expr,i=e.alias,l=e.part,f=e.order,c=e.scope,s=e.byRows;l=null!=l&&l.length>0&&d(l[0])?l[0]:l,f=null!=f&&f.length>0&&d(f[0])?f[0]:f,c=null!=c&&c.length>0&&d(c[0])?c[0]:c,t=x(t,r,o,u,i,l,f,c,s)}return t},this.collect=function(){return this.evaluate(new ut)},this.count=function(){return this.map(function(t){return 1}).fold(0,function(t,n){return t+n})},this.countByValue=function(){var t=arguments.length>0?arguments[0]:function(t){return t};return this.map(function(n){return[t(n),1]}).groupByKey().mapValues(function(t){return ht.of(t).fold(0,function(t,n){return t+n})}).collectAsMap()},this.first=function(){var t=arguments[0],n=this;void 0!==t&&(n=n.filter(t));var e=n.take(1);return e.length>0?ht.Some(e[0]):ht.None()},this.fold=function(t,n,e){return this.evaluate(new lt(t,n,e))},this.forall=function(t){return this.evaluate(new ft(t))},this.foreach=function(t){this.evaluate(new ct(t))},this.last=function(){var t=arguments[0],n=this;return void 0!==t&&(n=n.filter(t)),n.evaluate(new st)},this.reduce=function(t,n){return this.evaluate(new pt(t,n))},this.take=function(t){return this.evaluate(new at(t))},this.collectAsMap=function(){return this.evaluate(new it(arguments[0],arguments[1]))},this.countByKey=function(){return this.mapValues(function(){return 1}).foldByKey(function(){return 0},function(t,n){return t+n},arguments[0]).collectAsMap()}}function dt(){}function yt(){}function wt(t,n,e){function r(t,n,e){this.array=t,this.index=n,this.end=e}n=Math.max(null==n?0:n,0),e=Math.min(null==e?t.length:e,t.length),r.prototype=new dt,r.prototype.close=function(){this.array=null,this.index=null,this.end=null},r.prototype.hasNext=function(){return this.index<this.end},r.prototype.next=function(){return this.array[this.index++]},this.iterator=function(){return new r(t,n,e)}}function vt(t,e){function r(){this.index=0,this.value=void 0}r.prototype=new dt,r.prototype.close=function(){"function"==typeof e&&e(this.index-1),this.index=null,this.value=null},r.prototype.hasNext=function(){return this.value=t(this.index++),this.value!==n},r.prototype.next=function(){return this.value},this.iterator=function(){return new r}}P.prototype.begin=function(){null!=this.downstream&&this.downstream.begin()},P.prototype.accept=void 0,P.prototype.done=function(){null!=this.downstream&&this.downstream.done()},b.prototype=new P,b.prototype.begin=function(){void 0===this.index&&(this.index=0),null!=this.downstream&&this.downstream.begin()},O.prototype=new P,O.prototype.settling=null,O.prototype.begin=function(){void 0===this.settle()&&null!=this.settling&&this.settle(this.settling()),null!=this.downstream&&this.downstream.begin()},O.prototype.settle=function(){return arguments.length>0?(this.sediment=arguments[0],this):this.sediment},k.prototype=new O,k.prototype.settling=function(){return[]},k.prototype.accept=function(t){return this.settle().push(t),!0},M.prototype=new O,M.prototype.settling=function(){return{}},M.prototype.keyOf=r,M.prototype.valOf=o,M.prototype.accept=function(t){var n=this.keyOf(t),e=this.settle(),r=e[n];return null==r&&(r=[],e[n]=r),r.push(this.valOf(t)),!0},M.prototype.done=function(){if(null!=this.downstream){var t=this.settle();for(var n in t)if(t.hasOwnProperty(n)&&!this.downstream.accept([n,t[n]]))break;this.downstream.done()}},B.prototype=new P,B.prototype.that=void 0,B.prototype.begin=function(){void 0===this.branch&&(this.branch=this.that().collect()),null!=this.downstream&&this.downstream.begin()},N.prototype=new M,N.prototype.that=void 0,N.prototype.base=void 0,N.prototype.join=void 0,N.prototype.done=function(){if(null!=this.downstream){var t=this.settle(),n=this.that().groupByKey(this.keyR,this.valR).collectAsMap(),e=this.base(t,n),r=this.downstream;for(var o in e)if(e.hasOwnProperty(o)&&!this.join(r,o,t[o],n[o]))break;r.done()}},S.prototype.newPond=void 0,R.prototype=new S,j.prototype=new S,K.prototype=new S,W.prototype=new S,A.prototype=new S,E.prototype=new S,J.prototype=new S,_.prototype=new S,V.prototype=new S,z.prototype=new S,D.prototype=new S,I.prototype=new S,L.prototype=new S,C.prototype=new S,F.prototype=new S,T.prototype=new S,$.prototype=new S,q.prototype=new S,G.prototype=new S,H.prototype=new S,Q.prototype=new S,U.prototype=new S,X.prototype=new S,Y.prototype=new S,Z.prototype=new S,tt.prototype=new S,nt.prototype=new S,et.prototype=new S,rt.prototype=new S,ot.prototype=new O,ot.prototype.get=function(){return this.settle()},ut.prototype=new S,it.prototype=new S,lt.prototype=new S,ft.prototype=new S,ct.prototype=new S,st.prototype=new S,pt.prototype=new S,at.prototype=new S,ht.eod=function(){return n},ht.keysOfObject=function(t){var n=[];if(null!=t)for(var e in t)t.hasOwnProperty(e)&&n.push(e);return n},ht.mapOfPairs=function(t){for(var n={},e=0;e<t.length;e++){var r=t[e];n[r[0]]=r[1]}return n},ht.pairsOfMap=function(t,n){var e=[];null==n&&(n=ht.keysOfObject(t));for(var r=0;r<n.length;r++){var o=n[r];e.push([o,t[o]])}return e},dt.prototype.close=void 0,dt.prototype.hasNext=void 0,dt.prototype.next=void 0,yt.prototype.iterator=void 0,wt.prototype=new yt,vt.prototype=new yt,ht.of=function(t){return t instanceof ht?t:t instanceof Array?(new ht).source(new wt(t,arguments[1],arguments[2])):t instanceof vt?(new ht).source(t):"function"==typeof t?(new ht).source(new vt(t,arguments[1])):ht.of(ht.pairsOfMap(t,arguments[1]))};var gt=function(t){return t.all?t:(t.as=function(t){return this.alias=t,this},t.asc=function(){return this.order=!0,this},t.desc=function(){return this.order=!1,this},t.nullsFirst=function(){return this.nulls="first",this},t.nullsLast=function(){return this.nulls="last",this},t)};function mt(){}function xt(t){this.get=function(){return t},this.source(new wt([t]))}function Pt(){this.source(new wt(t))}function bt(){this.aggr=null,this.updt=null,this.expr=null,this.alias=null,this.part=null,this.order=null,this.byRows=null,this.scope=null}return mt.prototype=new ht,mt.prototype.get=u,mt.prototype.or=void 0,mt.prototype.orElse=void 0,mt.prototype.orNull=void 0,mt.prototype.given=void 0,mt.prototype.filter=void 0,mt.prototype.map=void 0,mt.prototype.col=function(t){var n=null,e=this.or({});if(null==t)n=function(){return null};else if("*"===t)(n=c(e)).alias=t;else if("function"!=typeof t){var r=t.toString();(n=function(){return e[r]}).alias=r}else(n=function(){return t(e)}).alias=t.alias,n.order=t.order,n.nulls=t.nulls;return gt(n)},mt.prototype.$=mt.prototype.col,xt.prototype=new mt,xt.prototype.or=function(t){return this.get()},xt.prototype.orElse=function(){return this},xt.prototype.orNull=function(){return this.get()},xt.prototype.given=function(){return!0},xt.prototype.filter=function(t){return t(this.get(),0)?this:ht.None()},xt.prototype.map=function(t){return ht.Some(t(this.get(),0))},Pt.prototype=new mt,Pt.prototype.or=function(t){return t},Pt.prototype.orElse=function(t){return t},Pt.prototype.orNull=function(){return null},Pt.prototype.given=function(){return!1},Pt.prototype.filter=function(t){return this},Pt.prototype.map=function(t){return this},ht.Some=function(t){return new xt(t)},ht.None=function(){return new Pt},ht.Option=function(t){return null==t?ht.None():ht.Some(t)},ht.col=function(t){var n=null;if(null==t)n=function(){return null};else if("*"===t)(n=c(null)).alias=t;else if("function"!=typeof t){var e=t.toString();(n=function(t){return t[e]}).alias=e}else(n=function(n){return t(n)}).alias=t.alias,n.order=t.order,n.nulls=t.nulls;return gt(n)},ht.row=function(){var t={},n=arguments[0],e=[];if(h(n))for(var r in n)null!=n[r]&&n[r].all?e.push(n[r]):t[r]=n[r];else for(var o=d(n)?n:arguments,u=null,i=0;i<o.length;i++)(u=o[i]).all?e.push(u):t[u.alias]=u;var l={};for(i=0;i<e.length;i++){var f=e[i]();for(var r in f)f.hasOwnProperty(r)&&(l[r]=f[r])}for(var r in t)t.hasOwnProperty(r)&&(l[r]=t[r]());return l},bt.prototype.aggregator=function(){return arguments.length>0?(this.aggr=arguments[0],this):this.aggr},bt.prototype.updater=function(){return arguments.length>0?(this.updt=arguments[0],this):this.updt},bt.prototype.expressor=function(){return arguments.length>0?(this.expr=arguments[0],this):this.expr},bt.prototype.as=function(){return arguments.length>0?(this.alias=arguments[0],this):this.alias},bt.prototype.partBy=function(){return arguments.length>0?(this.part=arguments,this):this.part},bt.prototype.orderBy=function(){return arguments.length>0?(this.order=arguments,this):this.order},bt.prototype.rows=function(){return this.byRows=!0,this},bt.prototype.range=function(){return this.byRows=!1,this},bt.prototype.between=function(){return arguments.length>1?(this.scope=[arguments[0],arguments[1]],this):1==arguments.length?(this.scope=arguments[0],this):this.scope},ht.item=function(t){var n=new bt;return"function"==typeof t?n.updater(t):null!=t&&(n.aggregator(t.aggr),n.updater(t.updt),n.expressor(t.expr)),n},ht.wf={avg:function(t){return t instanceof bt?ht.item(function(n,e,r,o){var u=t.updater()(n,e,r,o).filter(function(t){return null!=t});return u.reduce(function(t,n){return t+n}).get()/u.count()}):ht.item(function(n,e,r,o){var u=ht.of(e,r,o).map(t).filter(function(t){return null!=t});return u.reduce(function(t,n){return t+n}).get()/u.count()})},count:function(t){return t instanceof bt?ht.item(function(n,e,r,o){return t.updater()(n,e,r,o).filter(function(t){return null!=t}).count()}):ht.item(function(n,e,r,o){return ht.of(e,r,o).map(t).filter(function(t){return null!=t}).count()})},cume_dist:function(){return ht.item({aggr:function(t){return ht.of(t).flatMap(function(t){return t}).count()},updt:function(t,n,e,r){return n.length/t}})},dense_rank:function(){return ht.item({aggr:function(t){return ht.of(t).flatMap(function(t,n){return ht.of(t).map(function(t,e){return n+1}).collect()}).map(function(t,n){return[n,t]}).sortBy(function(t){return t[0]}).map(function(t){return t[1]}).collect()},expr:function(t,n){return n[t]}})},distinct:function(t){t=null!=t?t:e;var n=arguments.length>1?arguments[1]:null;return ht.item(function(e,r,o,u){return ht.of(r,o,u).map(t).distinct(n)})},first_value:function(t){return ht.item(function(n,e,r,o){return ht.of(e,r,o).map(t).first().get()})},fold:function(t,n){if(arguments[2]instanceof bt){var r=arguments[2];return ht.item(function(e,o,u,i){return r.updater()(e,o,u,i).fold(t(),n)})}r=null!=arguments[2]?arguments[2]:e;return ht.item(function(e,o,u,i){return ht.of(o,u,i).map(r).fold(t(),n)})},lag:function(t){var n=Math.max(arguments.length>1?arguments[1]:1,0),e=arguments.length>2?arguments[2]:void 0;return ht.item({expr:function(r,o,u){return r-n<0?e:t(u[r-n])}})},last_value:function(t){return ht.item(function(n,e,r,o){return ht.of(e,r,o).map(t).last().get()})},lead:function(t){var n=Math.max(arguments.length>1?arguments[1]:1,0),e=arguments.length>2?arguments[2]:void 0;return ht.item({aggr:function(t){return ht.of(t).flatMap(function(t){return t}).collect()},expr:function(r,o){return r+n>=o.length?e:t(o[r+n])}})},map_part:function(t){return ht.item({aggr:function(t){return ht.of(t).flatMap(function(t){return t}).collect()},updt:function(t){return t},expr:function(n,e){return t(e)}})},max:function(t){var n=arguments.length>1?arguments[1]:s;return ht.item(function(e,r,o,u){return ht.of(r,o,u).map(t).filter(function(t){return null!=t}).reduce(function(t,e){return n(t,e)<0?e:t}).get()})},min:function(t){var n=arguments.length>1?arguments[1]:s;return ht.item(function(e,r,o,u){return ht.of(r,o,u).map(t).filter(function(t){return null!=t}).reduce(function(t,e){return n(t,e)>0?e:t}).get()})},ntile:function(t){return t=Math.max(t,1),ht.item({aggr:function(n){for(var e=ht.of(n).flatMap(function(t){return t}).count(),r=Math.max(Math.floor(e/t),1),o=e<=t?0:e%t,u=[],i=1;i<=t;i++){for(var l=0;l<r;l++)u.push(i);i<=o&&u.push(i)}return u},expr:function(t,n){return n[t]}})},percent_rank:function(){return ht.item({aggr:function(t){var n=y(t).length-1;return ht.of(t).flatMap(function(t,n){return ht.of(t).map(function(t,e){return n}).collect()}).map(function(t,n){return[t,n]}).groupByKey().map(function(t){var n=t[1],e=ht.of(n).reduce(function(t,n){return t<n?t:n}).get();return ht.of(n).map(function(t){return[t,e]}).collect()}).flatMap().sortBy(function(t){return t[0]}).map(function(t){return 0==n?0:t[1]/n}).collect()},expr:function(t,n){return n[t]}})},rank:function(){return ht.item({aggr:function(t){return ht.of(t).flatMap(function(t,n){return ht.of(t).map(function(t,e){return n}).collect()}).map(function(t,n){return[t,n+1]}).groupByKey().map(function(t){return t[1]}).flatMap(function(t){var n=ht.of(t).reduce(function(t,n){return Math.min(t,n)}).get();return ht.of(t).map(function(t){return[t,n]}).collect()}).sortBy(function(t){return t[0]}).map(function(t){return t[1]}).collect()},expr:function(t,n){return n[t]}})},row_number:function(){return ht.item({expr:function(t){return t+1}})},sum:function(t){return t instanceof bt?ht.item(function(n,e,r,o){return t.updater()(n,e,r,o).map(l).reduce(function(t,n){return t+n}).get()}):ht.item(function(n,e,r,o){return ht.of(e,r,o).map(t).map(l).reduce(function(t,n){return t+n}).get()})}},ht.on=function(t){var n=arguments.length>1?arguments[1]:"canal";t.prototype[n]=function(){for(var t=[this],n=0;n<arguments.length;n++)t.push(arguments[n]);return ht.of.apply(this,t)}},ht.off=function(t){var n=arguments.length>1?arguments[1]:"canal";delete t.prototype[n]},ht.unit=e,ht.kop=r,ht.vop=o,ht.cmp=function(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);return function(n,e){if(n==e)return 0;if(null==n)return-1;if(null==e)return 1;for(var r=0,o=null,u=0;u<t.length;u++)if(o=t[u],0!=(r=s(n[o],e[o])))return r;return 0}},ht.nvl=i,ht.range=function(t,e,r){null==r&&(r=1);var o=t-r;return new vt(function(){var u=!1;return t<e?u=r>0&&o+r<e:t>e&&(u=r<0&&o+r>e),u?o+=r:n})},ht.signum=s,ht});