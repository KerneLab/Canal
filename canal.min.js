/*! canal.js v0.0.1 2016-10-17 */

(function(){function a(){this.downstream=null}function b(){this.index=void 0}function c(){this.sediment=void 0}function d(){}function e(){}function f(){this.branch=void 0}function h(){this.keyR=X,this.valR=Y}function j(){}function m(a){function b(){}b.prototype=new f,b.prototype.that=function(){return a},b.prototype.accept=function(a){var b=this.branch;for(i in b)if(!this.downstream.accept([a,b[i]]))return!1;return!0},this.newPond=function(){return new b}}function n(a){function b(){}b.prototype=new e,b.prototype.done=function(){if(null!=this.downstream){var b=this.settle(),c=[b],d={};for(k in b)d[k]=null;for(i in a){b=a[i].groupBy().collectAsMap();for(k in b)d[k]=null;c.push(b)}for(key in d){var e=[];for(g in c){var f=c[g][key];e.push(null!=f?f:[])}if(!this.downstream.accept([key,e]))break}this.downstream.done()}},this.newPond=function(){return new b}}function o(a){function b(){}a=null!=a?a:Z,b.prototype=new d,b.prototype.accept=function(b){var c=!1,d=this.settle();for(i in d)if(a(b,d[i])){c=!0;break}return c||d.push(b),!0},b.prototype.done=function(){if(null!=this.downstream){var a=this.settle();for(i in a)if(!this.downstream.accept(a[i]))break;this.downstream.done()}},this.newPond=function(){return new b}}function p(a){function c(){}c.prototype=new b,c.prototype.accept=function(b){return!a(b,this.index++)||this.downstream.accept(b)},this.newPond=function(){return new c}}function q(a){function c(){}c.prototype=new b,c.prototype.accept=function(b){var c=a(b,this.index++);if(c instanceof Array){for(i in c)if(!this.downstream.accept(c[i]))return!1;return!0}return this.downstream.accept(c)},this.newPond=function(){return new c}}function s(a){function c(){}c.prototype=new b,c.prototype.accept=function(b){return a(b,this.index++),this.downstream.accept(b)},this.newPond=function(){return new c}}function t(a,b,c,d,e){function f(){}b=null!=b?b:X,c=null!=c?c:X,d=null!=d?d:Y,e=null!=e?e:Y,f.prototype=new h,f.prototype.keyOf=function(a){return b(a)},f.prototype.valOf=function(a){return d(a)},f.prototype.that=function(){return a},f.prototype.base=function(a,b){var c={};for(i in a)c[i]=null;for(i in b)c[i]=null;return c},f.prototype.join=function(a,b,c,d){if(null!=c&&null!=d){for(l in c)for(r in d)if(!a.accept([b,[M.Some(c[l]),M.Some(d[r])]]))return!1}else if(null!=c){for(l in c)if(!a.accept([b,[M.Some(c[l]),M.None]]))return!1}else if(null!=d)for(r in d)if(!a.accept([b,[M.None,M.Some(d[r])]]))return!1;return!0},this.newPond=function(){var a=new f;return a.keyR=c,a.valR=e,a}}function u(a,b){function c(){}b=null!=b?b:Z,c.prototype=new f,c.prototype.that=function(){return a},c.prototype.accept=function(a){var c=this.branch;for(i in c)if(b(a,c[i]))return this.downstream.accept(a);return!0},this.newPond=function(){return new c}}function v(a,b){function c(){}a=null!=a?a:X,b=null!=b?b:Y,c.prototype=new e,c.prototype.keyOf=function(b){return a(b)},c.prototype.valOf=function(a){return b(a)},this.newPond=function(){return new c}}function w(a,b,c,d,e){function f(){}b=null!=b?b:X,c=null!=c?c:X,d=null!=d?d:Y,e=null!=e?e:Y,f.prototype=new h,f.prototype.keyOf=function(a){return b(a)},f.prototype.valOf=function(a){return d(a)},f.prototype.that=function(){return a},f.prototype.base=function(a,b){return a},f.prototype.join=function(a,b,c,d){if(null!=c&&null!=d)for(l in c)for(r in d)if(!a.accept([b,[c[l],d[r]]]))return!1;return!0},this.newPond=function(){var a=new f;return a.keyR=c,a.valR=e,a}}function x(a,b,c,d,e){function f(){}b=null!=b?b:X,c=null!=c?c:X,d=null!=d?d:Y,e=null!=e?e:Y,f.prototype=new h,f.prototype.keyOf=function(a){return b(a)},f.prototype.valOf=function(a){return d(a)},f.prototype.that=function(){return a},f.prototype.base=function(a,b){return a},f.prototype.join=function(a,b,c,d){if(null!=c)if(null!=d){for(l in c)for(r in d)if(!a.accept([b,[c[l],M.Some(d[r])]]))return!1}else for(l in c)if(!a.accept([b,[c[l],M.None]]))return!1;return!0},this.newPond=function(){var a=new f;return a.keyR=c,a.valR=e,a}}function y(a){function c(){}c.prototype=new b,c.prototype.accept=function(b){return this.downstream.accept(a(b,this.index++))},this.newPond=function(){return new c}}function z(b){function c(){}c.prototype=new a,c.prototype.accept=function(a){var c=a[1];return this.downstream.accept(b(c[0],c[1],a[0]))},this.newPond=function(){return new c}}function A(b,c,d){function e(){}c=null!=c?c:X,d=null!=d?d:Y,e.prototype=new a,e.prototype.accept=function(a){var e=c(a);return this.downstream.accept([e,b(d(a),e)])},this.newPond=function(){return new e}}function B(){function a(){}a.prototype=new d,a.prototype.done=function(){if(null!=this.downstream){var a=this.settle();a.reverse();for(i in a)if(!this.downstream.accept(a[i]))break;this.downstream.done()}},this.newPond=function(){return new a}}function C(a,b,c,d,e){function f(){}b=null!=b?b:X,c=null!=c?c:X,d=null!=d?d:Y,e=null!=e?e:Y,f.prototype=new h,f.prototype.keyOf=function(a){return b(a)},f.prototype.valOf=function(a){return d(a)},f.prototype.that=function(){return a},f.prototype.base=function(a,b){return b},f.prototype.join=function(a,b,c,d){if(null!=d)if(null!=c){for(r in d)for(l in c)if(!a.accept([b,[M.Some(c[l]),d[r]]]))return!1}else for(r in d)if(!a.accept([b,[M.None,d[r]]]))return!1;return!0},this.newPond=function(){var a=new f;return a.keyR=c,a.valR=e,a}}function D(a){function c(){}c.prototype=new b,c.prototype.accept=function(b){return this.index>=a?this.downstream.accept(b):(this.index++,!0)},this.newPond=function(){return new c}}function E(a,b){function c(){}b=null==b||b;var e=a;null==a||b||(e=function(b,c){return a(c,b)}),c.prototype=new d,c.prototype.done=function(a){if(null!=this.downstream){var c=this.settle();null!=e?c.sort(e):(c.sort(),b||c.reverse());for(i in c)if(!this.downstream.accept(c[i]))break;this.downstream.done()}},this.newPond=function(){return new c}}function F(a,b){function c(){}b=null!=b?b:Z,c.prototype=new f,c.prototype.that=function(){return a},c.prototype.accept=function(a){var c=!1,d=this.branch;for(i in d)if(b(a,d[i])){c=!0;break}return!!c||this.downstream.accept(a)},this.newPond=function(){return new c}}function G(){}function H(){function a(){}a.prototype=new G,a.prototype.settling=function(){return[]},a.prototype.accept=function(a){return this.settle().push(a),!0},this.newPond=function(){return new a}}function I(a,b){function c(){}a=null!=a?a:X,b=null!=b?b:Y,c.prototype=new G,c.prototype.settling=function(){return{}},c.prototype.accept=function(c){return this.settle()[a(c)]=b(c),!0},this.newPond=function(){return new c}}function J(a,b){function c(){}c.prototype=new G,c.prototype.settling=function(){return a},c.prototype.accept=function(a){var c=b(this.settle(),a);return void 0!==c&&this.settle(c),!0},this.newPond=function(){return new c}}function K(a){function b(){}b.prototype=new G,b.prototype.settling=function(){return[]},b.prototype.accept=function(b){return this.settle().length<a&&(this.settle().push(b),!0)},this.newPond=function(){return new b}}function L(b){function c(){}c.prototype=new a,c.prototype.accept=function(a){return this.downstream.accept(a)},c.prototype.done=function(){null!=this.downstream&&(null!=b?b.converge(this.downstream):this.downstream.done())},this.newPond=function(){return new c}}function M(){}function N(a){this.val=a}function O(){}function P(){}function Q(){}function R(a){function b(){this.index=0}var c=a.length;b.prototype=new P,b.prototype.hasNext=function(){return this.index<c},b.prototype.next=function(){return a[this.index++]},this.iterator=function(){return new b}}function S(a){function b(){this.index=0,this.value=void 0}b.prototype=new P,b.prototype.hasNext=function(){return this.value=a(this.index++),this.value!==W},b.prototype.next=function(){return this.value},this.iterator=function(){return new b}}function T(){var a=this,b=null,c=null,d=null,e=function(b){for(prev=a;null!=prev&&null!=prev.operator();prev=prev.upstream()){var c=prev.operator().newPond();c.downstream=b,b=c}return b},f=function(a,b){a.begin();for(var c=b.iterator();c.hasNext()&&a.accept(c.next()););a.done()},g=function(){for(var b=a,c=a;null!=b&&null!=c.upstream()&&(b=b.upstream(),c=c.upstream().upstream(),null!=c);)if(b==c)return!1;return!0};this.upstream=function(){return arguments.length>0?(b=arguments[0],a):b},this.operator=function(){return arguments.length>0?(c=arguments[0],a):c},this.add=function(b){if(null!=b)return(new T).operator(b).upstream(a).source(this.source());throw new Error("Intermediate Operator Should Not Be null.")},this.source=function(){return arguments.length>0?(d=arguments[0],a):d},this.converge=function(a,b){if(null!=a){if(b=null!=b?b:this.source(),null!=b){if(g())return f(e(a),b),a;throw new Error("Loop Dependency Was Detected.")}throw new Error("Data Source Was Not Specified.")}throw new Error("Downstream Pond Was Not Specified.")},this.evaluate=function(a){if(null!=a)return this.converge(a.newPond(),arguments[1]).get();throw new Error("Terminate Operator Was Not Specified.")},this.cartesian=function(a){return this.add(new m(a))},this.distinct=function(){return this.add(new o(arguments[0]))},this.filter=function(a){return this.add(new p(a))},this.flatMap=function(a){return this.add(new q(a))},this.foreach=function(a){return this.add(new s(a))},this.groupBy=function(){return this.add(new v(arguments[0],arguments[1]))},this.intersection=function(a){return this.add(new u(a,arguments[1]))},this.keyBy=function(a){return this.map(function(b,c){return[a(b,c),b]})},this.map=function(a){return this.add(new y(a))},this.reverse=function(){return this.add(new B)},this.skip=function(a){return this.add(new D(a))},this.sortWith=function(){return this.add(new E(arguments[0],arguments[1]))},this.subtract=function(a){return this.add(new F(a,arguments[1]))},this.top=function(){var a=arguments.length>0?arguments[0]:1;return this.filter(function(b,c){return c<a})},this.union=function(a){return this.add(new L(a))},this.zip=function(a){return this.map(function(a,b){return[b,a]}).join(a.map(function(a,b){return[b,a]})).mapJoint(function(a,b){return[a,b]})},this.cogroup=function(){return this.add(new n(arguments))},this.fullJoin=function(a){return this.add(new t(a,arguments[1],arguments[2],arguments[3],arguments[4]))},this.join=function(a){return this.add(new w(a,arguments[1],arguments[2],arguments[3],arguments[4]))},this.leftJoin=function(a){return this.add(new x(a,arguments[1],arguments[2],arguments[3],arguments[4]))},this.mapJoint=function(a){return this.add(new z(a))},this.mapValues=function(a){return this.add(new A(a,arguments[1],arguments[2]))},this.reduceByKey=function(a,b){return this.groupBy(arguments[2],arguments[3]).mapValues(function(c,d){return T.of(c).reduce(a(d),b)})},this.rightJoin=function(a){return this.add(new C(a,arguments[1],arguments[2],arguments[3],arguments[4]))},this.collect=function(){return this.evaluate(new H)},this.count=function(){return this.map(function(a){return 1}).evaluate(new J(0,function(a,b){return a+b}))},this.countByValue=function(){var a=arguments.length>0?arguments[0]:function(a){return a};return this.map(function(b){return[a(b),1]}).groupBy().mapValues(function(a){return T.of(a).reduce(0,function(a,b){return a+b})}).collectAsMap()},this.first=function(){var a=this.take(1);return a.length>0?M.Some(a[0]):M.None},this.reduce=function(a,b){return this.evaluate(new J(a,b))},this.take=function(a){return this.evaluate(new K(a))},this.collectAsMap=function(){return this.evaluate(new I(arguments[0],arguments[1]))},this.countByKey=function(){return this.mapValues(function(){return 1}).reduceByKey(function(){return 0},function(a,b){return a+b},arguments[0]).collectAsMap()}}var U="object"==typeof global&&global||this,V=[],W={},X=function(a){return a[0]},Y=function(a){return a[1]},Z=function(a,b){return a===b};a.prototype.begin=function(){null!=this.downstream&&this.downstream.begin()},a.prototype.accept=function(a){},a.prototype.done=function(){null!=this.downstream&&this.downstream.done()},b.prototype=new a,b.prototype.begin=function(){void 0===this.index&&(this.index=0),null!=this.downstream&&this.downstream.begin()},c.prototype=new a,c.prototype.settling=null,c.prototype.begin=function(){void 0===this.settle()&&null!=this.settling&&this.settle(this.settling()),null!=this.downstream&&this.downstream.begin()},c.prototype.settle=function(){return arguments.length>0?(this.sediment=arguments[0],this):this.sediment},d.prototype=new c,d.prototype.settling=function(){return[]},d.prototype.accept=function(a){return this.settle().push(a),!0},e.prototype=new c,e.prototype.settling=function(){return{}},e.prototype.keyOf=X,e.prototype.valOf=Y,e.prototype.accept=function(a){var b=this.keyOf(a),c=this.settle(),d=c[b];return null==d&&(d=[],c[b]=d),d.push(this.valOf(a)),!0},e.prototype.done=function(){if(null!=this.downstream){var a=this.settle();for(group in a)if(!this.downstream.accept([group,a[group]]))break;this.downstream.done()}},f.prototype=new a,f.prototype.that=function(){},f.prototype.begin=function(){void 0===this.branch&&(this.branch=this.that().collect()),null!=this.downstream&&this.downstream.begin()},h.prototype=new e,h.prototype.that=function(){},h.prototype.base=function(a,b){},h.prototype.join=function(a,b,c,d){return!1},h.prototype.done=function(){if(null!=this.downstream){var a=this.settle(),b=this.that().groupBy(this.keyR,this.valR).collectAsMap(),c=this.base(a,b),d=this.downstream;for(k in c)if(!this.join(d,k,a[k],b[k]))break;d.done()}},j.prototype.newPond=function(){return new a},m.prototype=new j,n.prototype=new j,o.prototype=new j,p.prototype=new j,q.prototype=new j,s.prototype=new j,t.prototype=new j,u.prototype=new j,v.prototype=new j,w.prototype=new j,x.prototype=new j,y.prototype=new j,z.prototype=new j,A.prototype=new j,B.prototype=new j,C.prototype=new j,D.prototype=new j,E.prototype=new j,F.prototype=new j,G.prototype=new c,G.prototype.get=function(){return this.settle()},H.prototype=new j,I.prototype=new j,J.prototype=new j,K.prototype=new j,L.prototype=new j,M.prototype.get=function(){},M.prototype.or=function(a){},M.prototype.orNull=function(){},M.prototype.given=function(){},M.prototype.canal=function(){},N.prototype=new M,N.prototype.get=function(){return this.val},N.prototype.or=function(a){return this.get()},N.prototype.orNull=function(){return this.get()},N.prototype.given=function(){return!0},N.prototype.canal=function(){return(new T).source([this.get()])},M.Some=function(a){return new N(a)},O.prototype=new M,O.prototype.or=function(a){return a},O.prototype.orNull=function(){return null},O.prototype.given=function(){return!1},O.prototype.canal=function(){return(new T).source(V)},M.None=new O,P.prototype.hasNext=function(){},P.prototype.next=function(){},Q.prototype.iterator=function(){},R.prototype=new Q,S.prototype=new Q,T.eod=function(){return W},T.of=function(a){return a instanceof Array?(new T).source(new R(a)):a instanceof Function?(new T).source(new S(a)):T.of(T.pairsOfMap(a))},T.mapOfPairs=function(a){var b={};for(i in a){var c=a[i];b[c[0]]=c[1]}return b},T.pairsOfMap=function(a){var b=[];for(i in a)b.push([i,a[i]]);return b},U.Canal=T}).call(this);
//# sourceMappingURL=canal.min.map